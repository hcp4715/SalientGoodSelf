---
title             : "Supplementary Materials for Perpecptual Salience of Positive Self"
shorttitle        : "Supplementary Materials"

author: 
  - name          : "Hu Chuan-Peng"
    affiliation   : "1,2"
    corresponding : yes    # Define only one corresponding author
    address       : "School of Psychology, Nanjing Normal University, Ninghai Road 122, Gulou District, 210024 Nanjing, China"
    email         : "hcp4715@hotmail.com"
  - name          : "Kaiping Peng"
    affiliation   : "2"
  - name          : "Jie Sui"
    affiliation   : "2,3"

affiliation:
  - id            : "1"
    institution   : "Nanjing Normal University, 210024 Nanjing, China"
  - id            : "2"
    institution   : "Tsinghua University, 100084 Beijing, China"
  - id            : "3"
    institution   : "University of Aberdeen, Aberdeen, Scotland"
    
authornote: |
  Hu Chuan-Peng, School of Psychology, Nanjing Normal University, 210024 Nanjing, China.
  Kaiping Peng, Department of Psychology, Tsinghua University, 100084 Beijing, China.
  Jie Sui, School of Psychology, University of Aberdeen, Aberdeen, Scotland.
  Authors contriubtion: HCP, JS, & KP design the study, HCP collected the data, HCP analyzed the data and drafted the manuscript. All authors read and agreed upon the current version of the manuscripts.

  Authors contriubtion: HCP, JS, & KP design the study, HCP collected the data, HCP analyzed the data and drafted the manuscript. KP & JS supported this project.

wordcount         : "X"

bibliography      :  
  - r-references.bib
  - endnote.bib

floatsintext      : no
figurelist        : no
tablelist         : no
footnotelist      : no
linenumbers       : yes
mask              : no
draft             : no

documentclass     : "apa6"
classoption       : "man"
output            : 
  papaja::apa6_pdf:
    latex_engine  : xelatex
---

# About the Supplementary
Here we described the details of each experiment and summary results. Also, we visualized the summary results for each experiment. As the de-identified raw data are open, interested readers can easily get the results without much difficult.

```{r setup, include=FALSE}
rm(list = ls())

# set local encoding to English
if (.Platform$OS.type == 'windows') {
  Sys.setlocale(category = 'LC_ALL','English_United States.1250')
} else {
  Sys.setlocale(category = 'LC_ALL','en_US.UTF-8')
}

Sys.setenv(LANG = "en") # set the feedback language to English
options(scipen = 999)   # force R to output in decimal instead of scientific notion
options(digits=5)       # limit the number of reporting

curDir = here::here() #dirname(rstudioapi::getActiveDocumentContext()$path)

# use pacman to manage the packages
if (!require(pacman)){
        install.packages("pacman")
        library(pacman)
}

# use pacman::p_load to load the packages
pacman::p_load('here',              # for choosing directory
               'tidyverse',         # for data wrangling
               "ggplot2",           # plot general
               'ggridges',          # plot ridges
               'patchwork',         # plot patch plots together
               "papaja",            # core for reproduce the APA format of the manuscript
               "easystats",
               "qgraph"
               )

# source("geom_flat_violin.R")       # for plotting the violin plots
source('Initial_suppl_simple.r')


# using afex and emmeans to do the ANOVA and emmeans for post-hoc comparison
options(tinytex.verbose = F) # debug the tex
knitr::opts_chunk$set(message = FALSE)

set.seed(42)
knitr::opts_chunk$set(cache.extra = knitr::rand_seed)

CommonColnames_d  <- c("ExpID", "Site", "Subject", "Age", "Sex", 'Domain', "Identity", "Valence", "dprime")
CommonColnames_rt <- c("ExpID", "Site", "Subject", "Age", "Sex", 'Domain', "Matchness", "Identity", "Valence", "RT")

load("AllData.RData")
```

# Experiment 1a

## Methods
### Participants
`r df1a.T.basic$N` college students (`r df1a.T.basic$Nf` female, age = `r df1a.T.basic$Age_mean` $\pm$ `r df1a.T.basic$Age_sd` years) participated. `r df1a.T.basic$N_thu` of them were recruited from Tsinghua University community in 2014; `r df1a.T.basic$N_wzu` were recruited from Wenzhou University in 2017. All participants were right-handed except one, and all had normal or corrected-to-normal vision. Informed consent was obtained from all participants prior to the experiment according to procedures approved by the local ethics committees. `r nrow(df1a.excld.sub)` participant’s data were excluded from analysis because nearly random level of accuracy, leaving `r df1a.v.basic$N` participants (`r df1a.v.basic$Nf` female, age = `r df1a.v.basic$Age_mean` $\pm$ `r df1a.v.basic$Age_sd` years).

### Stimuli and Tasks
Three geometric shapes were used in this experiment: triangle, square, and circle. These shapes were paired with three labels (bad person, good person or neutral person). The pairs were counterbalanced across participants. 

### Procedure
As we describe in general method part, this experiment had two phases. First, there was a learning stage. Participants were asked to learn the relationship between geometric shapes (triangle, square, and circle) and different person (bad person, a good person, or a neutral person). For example, a participant was told, “bad person is a circle; good person is a triangle; and a neutral person is represented by a square.” After participant remember the associations (usually in a few minutes), participants started a practicing phase of matching task which has the exact task as in the experimental task. 
In the experimental task, participants judged whether shape–label pairs, which were subsequently presented, were correct. Each trial started with the presentation of a central fixation cross for 500 ms. Subsequently, a pairing of a shape and label (good person, bad person, and neutral person) was presented for 100 ms. The pair presented could confirm to the verbal instruction for each pairing given in the training stage, or it could be a recombination of a shape with a different label, with the shape–label pairings being generated at random. The next frame showed a blank for 1100ms. Participants were expected to judge whether the shape was correctly assigned to the person by pressing one of the two response buttons as quickly and accurately as possible within this timeframe (to encourage immediate responding). Feedback (correct or incorrect) was given on the screen for 500 ms at the end of each trial, if no response detected, “too slow” was presented to remind participants to accelerate. Participants were informed of their overall accuracy at the end of each block. The practice phase finished and the experimental task began after the overall performance of accuracy during practice phase achieved 60%. 
For participants from the Tsinghua community, they completed 6 experimental blocks of 60 trials. Thus, there were 60 trials in each condition (bad-person match, bad-person nonmatch, good-person match, good-person nonmatch, neutral-person match, and neutral-person nonmatch). For the participants from Wenzhou University, they finished 6 blocks of 120 trials, therefore, 120 trials for each condition.

## Descriptive results

```{r 'ex1a-dprime-rt', fig.cap="RT and *d* prime of Experiment 1a.", fig.height=4.5, fig.width=9, warning=FALSE}
# rtdata <- df1a.v.rt_m %>% dplyr::filter(Matchness == "Match") %>% dplyr::rename(RT = RT_m)
# Mplots(expName = 'exp1a', df1a.v.dprime_l, rtdata)
Val_plot_NHST(df.rt = df1a.v.rt_m, df.d = df1a.v.dprime_l)
```

See figure \@ref(fig:ex1a-dprime-rt) for *d* prime and reaction times of experiment 1a.

# Experiment 1b
In this study, we aimed at excluding the potential confounding factor of the familiarity of words we used in experiment 1a, by matching the familiarity of the words.

## Method
### Participants
`r df1b.T.basic$N` college students (`r df1b.T.basic$Nf` female, age = `r df1b.T.basic$Age_mean` $\pm$ `r df1b.T.basic$Age_sd` years) participated. `r df1b.T.basic$N_thu` of them were recruited from Tsinghua University community in 2014; `r df1b.T.basic$N_wzu` were recruited from Wenzhou University in 2017. All participants were right-handed except one, and all had normal or corrected-to-normal vision. Informed consent was obtained from all participants prior to the experiment according to procedures approved by the local ethics committees. `r nrow(df1b.excld.sub)` participant’s data were excluded from analysis because nearly random level of accuracy, leaving `r df1b.v.basic$N` participants (`r df1b.v.basic$Nf` female, age = `r df1b.v.basic$Age_mean` $\pm$ `r df1b.v.basic$Age_sd` years).

### Stimuli and Tasks
Three geometric shapes (triangle, square, and circle, with 3.7º × 3.7º of visual angle) were presented above a white fixation cross subtending 0.8º × 0.8º of visual angle at the center of the screen. The three shapes were randomly assigned to three labels with different moral valence: a morally bad person (“恶人”, ERen), a morally good person (“善人”, ShanRen) or a morally neutral person (“常人”, ChangRen). The order of the associations between shapes and labels was counterbalanced across participants.
Three labels used in this experiment is selected based on the rating results from an independent survey, in which participants rated the familiarity, frequency, and concreteness of eight different words online. Of the eight words, three of them are morally positive (HaoRen, ShanRen, Junzi), two of them are morally neutral (ChangRen, FanRen), and three of them are morally negative (HuaiRen, ERen, LiuMang). An independent sample consist of 35 participants (22 females, age 20.6 ± 3.11) were recruited to rate these words. Based on the ratings (see supplementary materials Figure S1), we selected ShanRen, ChangRen, and ERen to represent morally positive, neutral, and negative person. 
![Ratings of words in exp 1b](exp1b/Familiarity_ratings/df1b_fami_rating.pdf){width=500px}

### Procedure
For participants from both Tsinghua community and Wenzhou community, the procedure in the current study was exactly same as in experiment 1a.

## Descriptive results

```{r 'ex1b-dprime-rt', fig.cap="RT and *d* prime of Experiment 1b.", fig.height=4.5, fig.width=9, warning=FALSE}
# rtdata <- df1a.v.rt_m %>% dplyr::filter(Matchness == "Match") %>% dplyr::rename(RT = RT_m)
# Mplots(expName = 'exp1a', df1a.v.dprime_l, rtdata)
Val_plot_NHST(df.rt = df1b.v.rt_m, df.d = df1b.v.dprime_l)
```

See figure \@ref(fig:ex1b-dprime-rt) for *d* prime and reaction times of experiment 1b.

# Experiment 1c
In this study, we further control the valence of words using in our experiment. Instead of using label with moral valence, we used valence-neutral names in China. Participant first learn behaviors of the different person, then, they associate the names and shapes. And then they perform a name-shape matching task.

## Method

### Participants
`r df1c.T.basic$N` college students (`r df1c.T.basic$Nf` female, age = `r df1c.T.basic$Age_mean` $\pm$ `r df1c.T.basic$Age_sd` years) participated. All of them were recruited from Tsinghua University community in 2014. Informed consent was obtained from all participants prior to the experiment according to procedures approved by the local ethics committees. No participant was excluded because they overall accuracy were above 0.6.

### Stimuli and Tasks
Three geometric shapes (triangle, square, and circle, with 3.7º × 3.7º of visual angle) were presented above a white fixation cross subtending 0.8º × 0.8º of visual angle at the center of the screen. The three most common names were chosen, which are neutral in moral valence before the manipulation.
Three names (Zhang, Wang, Li) were first paired with three paragraphs of behavioral description. Each description includes one sentence of biographic information and four sentences that describing the moral behavioral under that name. To assess the that these three descriptions represented good, neutral, and bad valence, we collected the ratings of three person on six dimensions: morality, likability, trustworthiness, dominance, competence, and aggressiviess, from an independent sample (n = 34, 18 female, age = 19.6 ± 2.05). The rating results showed that the person with morally good behavioral description has higher score on morality (M = 3.59, SD = 0.66) than neutral (M = 0.88, SD = 1.1), *t*(33) = 12.94, *p* < .001, and bad conditions (M = -3.4, SD = 1.1), *t*(33) = 30.78, *p* < .001. Neutral condition was also significant higher than bad conditions $t(33) = 13.9$, $p < .001$ (See supplementary materials).

### Procedure
After arriving the lab, participants were informed to complete two experimental tasks, first a social memory task to remember three person and their behaviors, after tested for their memory, they will finish a perceptual matching task. 
In the social memory task, the descriptions of three person were presented without time limitation. Participant self-paced to memorized the behaviors of each person. After they memorizing, a recognition task was used to test their memory effect. Each participant was required to have over 95% accuracy before preceding to matching task.
The perceptual learning task was followed, three names were randomly paired with geometric shapes. Participants were required to learn the association and perform a practicing task before they start the formal experimental blocks. They kept practicing until they reached 70% accuracy. Then, they would start the perceptual matching task as in experiment 1a. They finished 6 blocks of perceptual matching trials, each have 120 trials. 

## Descriptive results

```{r 'ex1c-dprime-rt', fig.cap="RT and *d* prime of Experiment 1c.", fig.height=6, fig.width=10, warning=FALSE}
Val_plot_NHST(df.rt = df1c.v.rt_m, df.d = df1c.v.dprime_l)
```

See figure \@ref(fig:ex1c-dprime-rt) for *d* prime and reaction times of experiment 1c.

# Experiment 2: Sequential presenting

Experiment 2 was conducted for two purpose: (1) to further confirm the facilitation effect of positive moral associations; (2) to test the effect of expectation of occurrence of each pair. In this experiment, after participant learned the association between labels and shapes, they were presented a label first and then a shape, they then asked to judge whether the shape matched the label or not (see  (Sui, Sun, Peng, & Humphreys, 2014). Previous studies showed that when the labels presented before the shapes, participants formed expectations about the shape, and therefore a top-down process were introduced into the perceptual matching processing. If the facilitation effect of positive moral valence we found in experiment 1 was mainly drive by top-down processes, this sequential presenting paradigm may eliminate or attenuate this effect; if, however, the facilitation effect occurred because of button-up processes, then, similar facilitation effect will appear even with sequential presenting paradigm.

## Method

### Participants

`r df2.T.basic$N` participants (`r df2.T.basic$Nf` female, age = `r df2.T.basic$Age_mean` $\pm$ `r df2.T.basic$Age_sd`) were recruited. 24 of them had participated in Experiment 1a (9 male, mean age = 21.9, s.d. = 2.9), and the time gap between these experiment 1a and experiment 2 is at least six weeks. The results of `r nrow(df2.excld.sub)` participants were excluded from analysis because of less than 60% overall accuracy, remains `r df2.v.basic$N` participants (`r df2.v.basic$Nf` female, age = `r df2.v.basic$Age_mean` $\pm$ `r df2.v.basic$Age_sd`).

### Procedure
In Experiment 2, the sequential presenting makes the matching task much easier than experiment 1. To avoid ceiling effect on behavioral data, we did a few pilot experiments to get optimal parameters, i.e., the conditions under which participant have similar accuracy as in Experiment 1 (around 70 ~ 80% accuracy). 
In the final procedure, the label (good person, bad person, or neutral person) was presented for 50 ms and then masked by a scrambled image for 200 ms. A geometric shape followed the scrambled mask for 50 ms in a noisy background (which was produced by first decomposing a square with $¾$ gray area and $¼$ white area to small squares with a size of 2 × 2 pixels and then re-combine these small pieces randomly), instead of pure gray background in Experiment 1. After that, a blank screen was presented 1100 ms, during which participants should press a button to indicate the label and the shape match the original association or not. Feedback was given, as in study 1. The next trial then started after 700 ~ 1100 ms blank. Other aspects of study 2 were identical to study 1.

### Analysis
Data was analyzed as in study 1a. 

## Descriptive results

```{r 'ex2-dprime-rt', fig.cap="RT and *d* prime of Experiment 2.", fig.height=6, fig.width=10, warning=FALSE}
rtdata <- df2.v.rt_m %>% dplyr::filter(Matchness == "Match") %>% dplyr::rename(RT = RT_m)

Val_plot_NHST(df.rt = df2.v.rt_m, df.d = df2.v.dprime_l)

```

See figure \@ref(fig:ex2-dprime-rt) for *d* prime and reaction times of experiment 2.

# Experiment 3a

To examine the modulation effect of positive valence was an intrinsic, self-referential process, we designed study 3. In this study, moral valence was assigned to both self and a stranger. We hypothesized that the modulation effect of moral valence will be stronger for the self than for a stranger.

## Method

### Participants
`r df3a.T.basic$N` college students (`r df3a.T.basic$Nf` female, age = `r df3a.T.basic$Age_mean` $\pm$ `r df3a.T.basic$Age_sd`) participated in experiment 3a. All of them were right-handed, and all had normal or correted-to-normal vision. Informed consent was obtained from all participants prior to the experiment according to procedures approved by a local ethics committee. One female and one male student did not finish the experiment, and `r nrow(df3a.excld.sub)` participants' data were excluded from analysis because less than 60% overall accuracy, remains `r df3a.v.basic$N` participants (`r df3a.v.basic$Nf` female, age = `r df3a.v.basic$Age_mean` $\pm$ `r df3a.v.basic$Age_sd`).

### Design
Study 3a combined moral valence with self-relevance, hence the experiment has a   2 × 3 × 2 within-subject design. The first variable was self-relevance, include two levels: self-relevance vs. stranger-relevance; the second variable was moral valence, include good, neutral and bad; the third variable was the matching between shape and label: match vs. mismatch.

### Stimuli
The stimuli used in study 3a share the same parameters with experiment 1 & 2. 6 shapes were included (triangle, square, circle, trapezoid, diamond, regular pentagon), as well as 6 labels (good self, neutral self, bad self, good person, bad person, neutral person). To match the concreteness of the label, we asked participant to chosen an unfamiliar name of their own gender to be the stranger.

### Procedure
After being fully explained and signed the informed consent, participants were instructed to chose a name that can represent a stranger with same gender as the participant themselves, from a common Chinese name pool. Before experiment, the experimenter explained the meaning of each label to participants. For example, the “good self” mean the morally good side of themselves, them could imagine the moment when they do something’s morally applauded, “bad self” means the morally bad side of themselves, they could also imagine the moment when they doing something morally wrong, and “neutral self” means the aspect of self that doesn’t related to morality, they could imagine the moment when they doing something irrelevant to morality. In the same sense, the “good other”, “bad other”, and “neutral other” means the three different aspects of the stranger, whose name was chosen before the experiment. Then, the experiment proceeded as study 1a. Each participant finished 6 blocks, each have 120 trials. The sequence of trials was pseudo-randomized so that there are 10 matched trials for each condition and 10 non-matched trials for each condition (good self, neutral sef, bad self, good other, neutral other, bad other) for each block.

### Data Analysis
Data analysis followed strategies described in the general method section. Reaction times and *d* prime data were analyzed as in study 1 and study 2, except that one more within-subject variable (i.e., self-relevance) was included in the repeated measures ANOVA. 

## Descriptive results

```{r 'ex3a-dprime-rt', fig.cap="RT and *d* prime of Experiment 3a.", fig.height=6, fig.width=10, warning=FALSE}
Val_id_plot_NHST(df.rt = df3a.v.rt_m, df.d = df3a.v.dprime_l)
```

See figure \@ref(fig:ex3a-dprime-rt) for *d* prime and reaction times of experiment 3a.

# Experiment 3b
In study 3a, participants had to remember 6 pairs of association, which cause high cognitive load during the whole experiment. To eliminate the influence of cognitive load, we conducted study 3b, in which participant learn three aspect of self and stranger separately in to consecutive task. We hypothesize that we will replicate the pattern of study 3a, i.e., the effect of moral valence only occurs for self-relevant conditions.

## Method

### Participants
Study 3b were finished in 2017, at that time we have calculated that the effect size (Cohen’s $d$) of good-person (or good-self) vs. bad-person (or bad-other) was between 0.47 ~ 0.53, based on study 1a, 1b, 2, 3a, 4a, and 4b. Based on this effect size, we estimated that 54 participants would allow we to detect the effect size of Cohen’s = 0.5 with 95% power and alpha = 0.05, using G*power 3.192 (Faul, Erdfelder, Buchner, & Lang, 2009; Faul, Erdfelder, Lang, & Buchner, 2007). Therefore, we planned to stop after we arrived this number. During the data collected at Wenzhou University, `r df3b.T.basic$N` participants (`r df3b.T.basic$Nf` females; 19 to 25 years of age, age = `r df3b.T.basic$Age_mean` $\pm$ `r df3b.T.basic$Age_sd`) came to the testing room and we tested all of them during a single day. All participants were right-handed, and all had normal or corrected-to-normal vision. Informed consent was obtained from all participants prior to the experiment according to procedures approved by a local ethics committee. `r nrow(df3b.excld.sub)` participants’ data were excluded from analysis because their over all accuracy was lower than 60%, 1 more participant waw excluded because of zero hit rate for one condition, leaving `r df3b.v.basic$N` participants (`r df3b.v.basic$Nf`  females; 19 to 25 years old, age = `r df3b.v.basic$Age_mean` $\pm$ `r df3b.v.basic$Age_sd`). 


### Design
Study 3b has the same experimental design as 3a, with a 2× 3× 2 within-subject design. The first variable was self-relevance, include two levels: self-relevant vs. stranger-relevant; the second variable was moral valence, include good, neutral and bad; the third variable was the matching between shape and label: match vs. mismatch.
 Stimuli.	The stimuli used in study 3b share the same parameters with experiment 3a. 6 shapes were included (triangle, square, circle, trapezoid, diamond, regular pentagon), as well as 6 labels, but the labels changed to “good self”, “neutral self”, “bad self”, “good him/her”, bad him/her”, “neutral him/her”, the stranger’s label is consistent with participants’ gender. Same as study 3a, we asked participant to chosen an unfamiliar name of their own gender to be the stranger before showing them the relationship. Note, because of implementing error, the personal distance data did not collect for this experiment.
 
### Procedure
In this experiment, participants finished two matching tasks, i.e., self-matching task, and other-matching task. In the self-matching task, participants first associate the three aspects of self to three different shapes, and then perform the matching task. In the other-matching task, participants first associate the three aspects of the stranger to three different shapes, and then perform the matching task. The order of self-task and other-task are counter-balanced among participants.
Different from experiment 3a, after presenting the stimuli pair for 100ms, participant has 1900 ms to response, and they feedback with both accuracy and reaction time.
As in study 3a, before each task, the instruction showed the meaning of each label to participants. The self-matching task and other-matching task were randomized between participants. Each participant finished 6 blocks, each have 120 trials.

### Data Analysis
Data analysis is the same as study 3a.

## Results

```{r 'ex3b-dprime-rt', fig.cap="RT and *d* prime of Experiment 3b.", fig.height=6, fig.width=10, warning=FALSE}
Val_id_plot_NHST(df.rt = df3b.v.rt_m, df.d = df3b.v.dprime_l)
```

See figure \@ref(fig:ex3b-dprime-rt) for *d* prime and reaction times of experiment 3b.

# Experiment 4a
In study 1-3 participants made explicit judgments about moral associations. In Experiment 4, we examined whether the interaction between moral valence and identity occur even when one of the variable was irrelevant to the task. In experiment 4a, participants learnt associations between shapes and self/other labels, then made perceptual match judgments only about the self or other conditions labels and shapes (cf. Sui et al., 2012). However, we presented labels of different moral valence in the shapes, which means that the moral valence factor become task irrelevant. If the binding between moral good and self is intrinsic and automatic, then we will observe that facilitating effect of moral good for self conditions, but not for other conditions.

In study 4b, we changed the role of valence and identity in task. In this experiment, participants learn the association between moral valence and the made perceptual match judgments to associations between different moral valence and shapes as in study 1-3. Different from experiment 1 ~ 3, we made put the labels of "self/other" in the shapes so that identity served as an task irrelevant variable. As in experiment 4a, we also hypothesized that the intrinsic binding between morally good and self will enhance the performance of good self condition, even identity is irrelevant to the task.

## Methods
### Participants
`r df4a.T.basic$N` participants (`r df4a.T.basic$Nf` female, age = `r df4a.T.basic$Age_mean` $\pm$ `r df4a.T.basic$Age_sd`) participated the current study, `r df4a.T.basic$N_thu` of them were from Tsinghua University in 2015, `r df4a.T.basic$N_wzu` were from Wenzhou University participated in 2017. All participants were right-handed, and all had normal or corrected-to-normal vision. Informed consent was obtained from all participants prior to the experiment according to procedures approved by a local ethics committee. The data from `r nrow(df4a.excld.sub)` participants from Wenzhou site were excluded from analysis because their accuracy was close to chance (< 0.6). The results for the remaining `r df4a.v.basic$N` participants (`r df4a.v.basic$Nf` female, age = `r df4a.v.basic$Age_mean` $\pm$ `r df4a.v.basic$Age_sd`) were analyzed and reported.

### Experimental design
As in Experiment 3, a 2× 3× 2 within-subject design was used. The first variable was self-relevance (self and stranger associations); the second variable was moral valence (good, neutral and bad associations); the third variable was the matching between shape and label (matching vs. non-match for the personal association). 
However, in this the task, participants only learn the association between two geometric shapes and two labels (self and other), i.e., only self-relevance were related to the task. The moral valence manipulation was achieved by embeding the personal label of the labels in the geometric shapes, see below. For simplicity, the trials where shapes where paired with self and with a word of “good person” inside were shorted as good-self condition, similarly, the trials where shapes paired with the self and with a word of “bad person” inside were shorted as bad-self condition. Hence, we also have six conditions: good-self, neutral-self, bad-self, good-other, neutral-other, and bad-other.

### Stimuli
2 shapes were included (circle, square) and each appeared above a central fixation cross with the personal label appearing below.  However, the shapes were not empty but with a two-Chinese-character word in the middle, the word was one of three labels with different moral valence: “good person”, “bad person” and “neutral person”. Before the experiment, participants learned the self/other association, and were informed to only response to the association between shapes’ configure and the labels below the fixation, but ignore the words within shapes. Besides the behavioral experiments, participants from Tsinghua community also finished questionnaires as Experiments 3, and participants from Wenzhou community finished a series of questionnaire as the other experiment finished in Wenzhou, Zhejiang Province, China.

### Procedure
The procedure was similar to Experiment 1. There were 6 blocks of trial, each with 120 trials for 2017 data. Due to procedure error, the data collected in 2015 in Tsinghua community only have 60 trials for each block, i.e., 30 trials per condition. 

### Data analysis
The data were analyzed in the same way as in experiment 3a and 3b.

## Descriptive results

```{r 'ex4a-dprime-rt', fig.cap="RT and *d* prime of Experiment 4a.", fig.height=6, fig.width=10, warning=FALSE}
# 
# rtdata <- df4a.v.rt_m %>% dplyr::filter(Matchness == "Match") %>% dplyr::rename(RT = RT_m)
# 
# Mplots(expName = 'exp4a', df4a.v.dprime_l,rtdata)

Val_id_plot_NHST(df.rt = df4a.v.rt_m, df.d = df4a.v.dprime_l)
```

See figure \@ref(fig:ex4a-dprime-rt) for *d* prime and reaction times of experiment 4a.

# Experiment 4b

## Method

### Participants
`r df4b.T.basic$N` college students (`r df4b.T.basic$Nf` female, age = `r df4b.T.basic$Age_mean` $\pm$ `r df4b.T.basic$Age_sd`) participated the current study, `r df4b.T.basic$N_thu` of them were from Tsinghua University in 2015 `r df4b.T.basic$N_wzu` were from Wenzhou University participated in 2017. All participants were right-handed, and all had normal or corrected-to-normal vision. Informed consent was obtained from all participants prior to the experiment according to procedures approved by a local ethics committee. The data from `r nrow(df4b.excld.sub)` participants were excluded from analysis because their accuracy was close to chance (< 0.6). The results for the remaining `r df4b.v.basic$N` participants (`r df4b.v.basic$Nf` female, age = `r df4b.v.basic$Age_mean` $\pm$ `r df4b.v.basic$Age_sd`) were analyzed and reported.

### Experimental design
The experimental design of this experiment is same as experiment 4a:  a 3× 2 × 2 within-subject design with moral valence (good, neutral and bad associations), self-relatedness (self vs. other), and matchness between shape and label (match vs. mismatch for the personal association) as within-subject variables. However, in the current task, the participants learned the associations between three shapes and three labels with different moral valence: good-person, neutral-person, and bad-person. While the word “self” or “other” were presented in the shapes (see below).

### Stimuli
In this task, 3 shapes were included (circle, square, and trapezoid) and were presented above a central fixation cross, as in previous experiments.  Similar to experiment 4a, the shapes were not empty but with a two-Chinese-character word in the middle corresponding to the labels “self” and “other”. Before the experiment, we informed participants only response to the relationship between shapes’shapes configure and the labels below the fixation, ignoring the words within each shape. Besides the behavioral experiments, participants also finished questionnaires as Experiments 1-3.

### Procedure
The procedure was similar to Experiment 4 a. Both samples of participants finished 6 blocks of trial, each with 120 trials.

### Data analysis
The data were analyzed as in experiment 4a.

## Descriptive results

```{r 'ex4b-dprime-rt', fig.cap="RT and *d* prime of Experiment 4b.", fig.height=6, fig.width=10, warning=FALSE}
# rtdata <- df4b.v.rt_m %>% dplyr::filter(Matchness == "Match") %>% dplyr::rename(RT = RT_m)
# 
# Mplots(expName = 'exp4b', df4a.v.dprime_l,rtdata)
# 

Val_id_plot_NHST(df.rt = df4b.v.rt_m, df.d = df4b.v.dprime_l)
```

See figure \@ref(fig:ex4b-dprime-rt) for *d* prime and reaction times of experiment 4b.

# Experiment 5: Generalization of positive effect
So far, we have considered the modulation effect of morality and found that the positive moral valence could enhance the perception. However, we still not sure whether this effect was moral specific or reflecting a more general mechanism of effect of positive valence. To test the specificity of morality, we conducted experiment 5, in which three more categories of stimuli were used (people of different attractiveness, scene of different attractiveness, and emotional words with different valence). In this study, participants finished 4 sessions of association task, each with different categories of stimuli.

## Method

### Participants
`r df5.T.basic$N` participant recruited from Tsinghua University university community (`r df5.T.basic$Nf` females; age = `r df5.T.basic$Age_mean` $\pm$ `r df5.T.basic$Age_sd`). All participants were right-handed, and all had normal or corrected-to-normal vision. Informed consent was obtained from all participants prior to the experiment according to procedures approved by the local ethics committee. The data from 5 participants were excluded from analysis, `r length(df5.subjQuit)` participant did not finished the experiment, and the other `r nrow(df5.excld.sub)` were excluded because of the overall accuracy was less than 60%. The results for the remaining `r df5.v.basic$N` subjects (`r df5.v.basic$Nf` female, age = `r df5.v.basic$Age_mean` $\pm$ `r df5.v.basic$Age_sd`) were included in data analyses.

### Experimental design
A 4 × 3 × 2 within-subject design was used. The first independent variable was stimuli categories (morality, attractiveness of people, attractiveness of scene, and emotional words); the second independent variables is valence (positive, neutral, and negative); the third variable was the matching between shape and label (match vs. mismatch for the association). Same as previous experiment, participants learn the associations between labels and shape and then perform matching tasks.

### Stimuli
4 sets of shapes were included (three circles, three rectangles, three triangles, and three quadrangles), each set of shape were paired with one category of label, counter-balanced across subjects. 

### Procedure
Participants finish 4 session of experiment, and each include one experiment as in experiment 1. And the order of each category was randomized for each participants. Each session started with a practice, and proceed to formal experiment when reached over 60% accuracy. Each session included 6 blocks of trial, each with 120 trials. 

Participants also finished questionnaires after finished the behavioral tasks.

## Descriptive results

```{r 'ex5-dprime-rt', fig.cap="RT and *d* prime of Experiment 5.", fig.height=6, fig.width=15, warning=FALSE}

df.plot5 <- df5.v.rt_m %>%
        dplyr::filter(Matchness == 'Match') %>%  # select matching data for plotting only.
        dplyr::rename(RT = RT_m) %>%
        dplyr::full_join(., df5.v.dprime_l) %>%  
        tidyr::pivot_longer(., cols = c(RT, dprime), 
                            names_to = 'DVs', 
                            values_to = "value") %>% # to longer format
        dplyr::mutate(Valence =factor(Valence, levels = c('Good','Neutral', 'Bad')),
                      taskType = factor(taskType, levels = c('Morality', 'Emotion', 'Person', 'Scene')),
                      DVs = factor(DVs, levels = c('RT', 'dprime')),
                      Conds = dplyr::case_when(
                            (Valence == 'Good' & taskType == 'Morality') ~ "0.8",
                            (Valence == 'Neutral' & taskType == 'Morality') ~ "1.0",
                            (Valence == 'Bad' & taskType == 'Morality') ~ "1.2",
                            (Valence == 'Good' & taskType == 'Emotion') ~ "1.8",
                            (Valence == 'Neutral' & taskType == 'Emotion') ~ "2.0",
                            (Valence == 'Bad' & taskType == 'Emotion') ~ "2.2",
                            (Valence == 'Good' & taskType == 'Person') ~ "2.8",
                            (Valence == 'Neutral' & taskType == 'Person') ~ "3.0",
                            (Valence == 'Bad' & taskType == 'Person') ~ "3.2",
                            (Valence == 'Good' & taskType == 'Scene') ~ "3.8",
                            (Valence == 'Neutral' & taskType == 'Scene') ~ "4.0",
                            (Valence == 'Bad' & taskType == 'Scene') ~ "4.2"),
                      Conds = as.numeric(Conds),
                      )

df.plot5$Conds_j <- jitter(df.plot5$Conds, amount=.05) # add gitter to x

levels(df.plot5$DVs ) <- c("RT"=expression(paste("Reaction ", "times (ms)")),
                    "dprime"=expression(paste(italic("d"), ' prime')))

df.plot5.sum_p <- summarySE(df.plot5, measurevar = "value", groupvars = c('Valence', 'taskType',"DVs")) %>%
        dplyr::mutate(taskType_num = ifelse(taskType == 'Morality', 1,
                                       ifelse(taskType == 'Emotion', 2, 
                                              ifelse(taskType == "Person", 3, 4))))

pd1 <- position_dodge(0.6)
scaleFUN <- function(x) sprintf("%.2f", x)
scales_y <- list(
RT = scale_y_continuous(limits = c(400, 900)),
dprime = scale_y_continuous(labels=scaleFUN)
)

p_df5_sum <- df.plot5  %>% # dplyr::filter(DVs== 'RT') %>%
        ggplot(., aes(x = taskType, y = value)) +
        geom_line(aes(x = Conds_j, y = value, group = Subject),         # link individual's points by transparent grey lines
                  linetype = 1, size = 0.8, colour = "#000000", alpha = 0.03) + 
        geom_point(aes(x = Conds_j, y = value, group = Subject, colour = as.factor(Valence)),   # plot individual points
                   #colour = "#000000",
                   size = 3, shape = 20, alpha = 0.15) +
        geom_point(data = df.plot5.sum_p, aes(x = taskType_num, # group mean
                                             y = value, 
                                             group = Valence, 
                                             colour = as.factor(Valence),
                                             ), 
                   shape = 18, position = pd1, size = 6) +
        geom_errorbar(data = df.plot5.sum_p, aes(x = taskType_num,  # group error bar.
                                                 y = value, 
                                                 group = Valence, 
                                                 colour = as.factor(Valence),
                                                 ymin = value- 1.96*se, 
                                                 ymax = value+ 1.96*se), 
                      width = .05, position = pd1, size = 2, alpha = 0.75) +
        scale_colour_brewer(palette = "Dark2") +
        scale_x_continuous(breaks=c(1, 2, 3, 4),
                           labels=c("Morality", "Emotion", "Person", "Scene")) +
        scale_fill_brewer(palette = "Dark2") +
        #ggtitle("A. Matching task") +
        theme_bw() +
        theme(panel.grid.major = element_blank(),
              panel.grid.minor = element_blank(),
              panel.background = element_blank(),
              panel.border = element_blank(),
              text=element_text(family='Times'),
              legend.title=element_blank(),
              legend.text = element_text(size =16),
              plot.title = element_text(lineheight=.8, face="bold", size = 18, margin=margin(0,0,20,0)),
              axis.text = element_text (size = 16, color = 'black'),
              axis.title = element_text (size = 16),
              axis.title.x = element_blank(),
              axis.title.y = element_blank(),
              axis.line.x = element_line(color='black', size = 1),    # increase the size of font
              axis.line.y = element_line(color='black', size = 1),    # increase the size of font
              strip.text = element_text (size = 16, color = 'black'), # size of text in strips, face = "bold"
              panel.spacing = unit(3, "lines")
              ) +
        facet_wrap( ~ DVs,
                    scales = "free_y", nrow = 1,
                    labeller = label_parsed)
p_df5_sum
```

See figure \@ref(fig:ex5-dprime-rt) for *d* prime and mean reaction times of experiment 5.

# Experiment 6a: EEG study 1
Experiment 6a was conducted to study the neural correlates of the positive prioritization effect. The behavioral paradigm is same as experiment 2. 

## Method

### Participants
`r df6a.T.basic$N` college students (`r df6a.T.basic$Nf` female, age = `r df6a.T.basic$Age_mean` $\pm$ `r df6a.T.basic$Age_sd`) participated the current study, all of them were from Tsinghua University in 2014. Informed consent was obtained from all participants prior to the experiment according to procedures approved by a local ethics committee. No participant was excluded from behavioral analysis.

### Experimental design
The experimental design of this experiment is same as experiment 2:  a 3 × 2 within-subject design with moral valence (good, neutral and bad associations) and matching between shape and label (match vs. mismatch for the personal association) as within-subject variables. 

### Stimuli
Three geometric shapes (triangle, square and circle, each 4.6º × 4.6º of visual angle) were presented at the center of screen for 50 ms after 500ms of fixation (0.8º × 0.8º of visual angle). The association of the three shapes to bad person (“坏人, HuaiRen”), good person (“好人, HaoRen”) or ordinary  person (“常人, ChangRen”) was counterbalanced across participants. The words bad person, good person or ordinary  person (3.6º × 1.6º) was also displayed at the center fo the screen. Participants had to judge whether the pairings of label and shape matched (e.g., Does the circle represent a bad person?). The experiment was run on a PC using E-prime software (version 2.0). These stimuli were displayed on a 22-in CRT monitor (1024×768 at 100Hz).
We used backward masking to avoid over-processing of the moral words, in which a scrambled picture were presented for 900 ms after the label. Also, to avoid the ceiling effect on accuracy, shapes were presented on a noisy background based on our pilot studies. The noisy images were made by scrambling a picture of 3/4gray and ¼ white at resolution of 2 × 2 pixel. 

### Procedure
The procedure was similar to Experiment 2. Participants finished 9 blocks of trial, each with 120 trials. In total, participants finished 180 trials for each combination of condition.

As in experiment 2 (Sui, He, & Humphreys, 2012), subjects first learned the associations between labels and shapes and then completed a shape-label matching task (e.g., good person-triangle). In each trial of the matching task, a fixation were first presented for 500 ms, followed by a 50 ms label; then, a scrambled picture presented 900 ms. After the backward mask, the shape were presented on a noisy background for 50ms. Participant have to response in 1000ms after the presentation of the shape, and finally, a feedback screen was presented for 500 ms (see figure 1). The inter-trial interval (ITI) were randomly varied at the range of 1000 ~ 1400 ms. 

All the stimuli were presented on a gray background (RGB: 127, 127, 127). E-primed 2.0 was used to present stimuli and collect behavioral results. Data were collected and analyzed when accuracy performance in total reached 60%. 

## Descriptive results

```{r 'ex6a-dprime-rt', fig.cap="RT and *d* prime of Experiment 6a.", fig.height=6, fig.width=15, warning=FALSE}
# rtdata <- df6a.v.rt_m %>% dplyr::filter(Matchness == "Match") %>% dplyr::rename(RT = RT_m)
# 
# Mplots(expName = 'exp6a', df6a.v.dprime_l,rtdata)

Val_plot_NHST(df.rt = df6a.v.rt_m, df.d = df6a.v.dprime_l)
```

Only the behavioral results were reported here. Figure \@ref(fig:ex6a-dprime-rt) shows *d* prime and reaction times of experiment 6a.

# Experiment 6b: EEG study 2
Experiment 6b was conducted to study the neural correlates of the prioritization effect of positive self, i.e., the neural underlying of the behavioral effect found int experiment 3a. However, as in experiment 5a, the procedure of this experiment was modified to adopted to ERP experiment. 

## Method

### Participants
`r df6b_d1.T.basic$N` college students (`r df6b_d1.T.basic$Nf` female, age = `r df6b_d1.T.basic$Age_mean` $\pm$ `r df6b_d1.T.basic$Age_sd`) participated the current study, all of them were recruited from Tsinghua University in 2016. Informed consent was obtained from all participants prior to the experiment according to procedures approved by a local ethics committee. For day 1's data, `r nrow(df6b_d1.excld.sub)` participant was excluded from the current analysis because of lower than 60% overall accuracy, remaining `r df6b_d1.v.basic$N` participants (`r df6b_d1.v.basic$Nf` female, age = `r df6b_d1.v.basic$Age_mean` $\pm$ `r df6b_d1.v.basic$Age_sd`). For day 2's data, one participant dropped out, leaving 22 participants  (`r df6b_d2.v.basic$Nf` female, age = `r df6b_d2.v.basic$Age_mean` $\pm$ `r df6b_d2.v.basic$Age_sd`), all of them has overall accuracy higher than 60%.

### Experimental design
The experimental design of this experiment is same as experiment 3:  a 2 × 3 × 2 within-subject design with self-relevance (self-relevant vs. other-relevant), moral valence (good, neutral, and bad) and matchness between shape and label (match vs. mismatch) as within-subject variables. 

### Stimuli
As in experiment 3a, 6 shapes were included (triangle, square, circle, trapezoid, diamond, regular pentagon), as well as 6 labels (good self, neutral self, bad self, good person, bad person, neutral person). To match the concreteness of the label, we asked participant to chosen an unfamiliar name of their own gender to be the stranger.

### Procedure
The procedure was similar to Experiment 2 and 6a. Subjects first learned the associations between labels and shapes and then completed a shape-label matching task. In each trial of the matching task, a fixation were first presented for 500 ms, followed by a 50 ms label; then, a scrambled picture presented 900 ms. After the backward mask, the shape were presented on a noisy background for 50ms. Participant have to response in 1000ms after the presentation of the shape, and finally, a feedback screen was presented for 500 ms (see figure 1). The inter-trial interval (ITI) were randomly varied at the range of 1000 ~ 1400 ms. 

All the stimuli were presented on a gray background (RGB: 127, 127, 127). E-primed 2.0 was used to present stimuli and collect behavioral results. Data were collected and analyzed when accuracy performance in total reached 60%. 

Because learning 6 associations was more difficult than 3 associations and participant might have low accuracy (see experiment 3a), the current study had extended to a two-day paradigm to maximizing the accurate trials that can be used in EEG data. At the first day, participants learnt the associations and finished 9 blocks of the matching task, each had 120 trials, without EEG recording. That is, each condition has 90 trials.

Participants came back to lab at the second day and finish the same task again, with EEG recorded. Before the EEG experiment, each participant finished a practice session again, if their accuracy is equal or higher than 85%, they start the experiment (one participant used lower threshold 75%). Each participant finished 18 blocks, each has 90 trials. One participant finished additional 6 blocks because of high error rate at the beginning, another two participant finished addition 3 blocks because of the technique failure in recording the EEG data. To increase the number of trials that can be used for EEG data analysis, matched trials has twice number as mismatched trials, therefore, for matched trials each participants finished 180 trials for each condition, for mismatched trials, each conditions has 90 trials.

## Results

```{r 'ex6b-d1-dprime-rt', fig.cap="RT and *d* prime for the first day of Experiment 6b.", fig.height=6, fig.width=15, warning=FALSE}

# rtdata <- df6b_d1.v.rt_m %>% dplyr::filter(Matchness == "Match") %>% dplyr::rename(RT = RT_m)
# 
# Mplots(expName = 'exp6b_d1', df6b_d1.v.dprime_l,rtdata)

Val_id_plot_NHST(df.rt=df6b_d1.v.rt_m, df.d=df6b_d1.v.dprime_l)
```

Only the behavioral results were reported here.

### Day one

Figure \@ref(fig:ex6b-d1-dprime-rt) shows *d* prime and reaction times from day 1 of the experiment 6b. 

```{r 'ex6b-d2-dprime-rt', fig.cap="RT and *d* prime for the second day of Experiment 6b.", fig.height=6, fig.width=15, warning=FALSE}
# calculate d prime
df6b_d2.v.dprime_l <- df6b_d2.v %>%
  dplyr::mutate(sdt = dplyr::case_when(ACC ==1 & Matchness == "Match" ~ "hit" ,    # code as hit
                                    ACC ==1  & Matchness == "Mismatch" ~"CR",      # correct reject
                                    ACC == 0 & Matchness == "Match" ~ "miss",      # miss
                                    ACC == 0 & Matchness == "Mismatch" ~ "FA",     # false alarm
                                    .default = NA)) %>% 
  dplyr::group_by(Site, Subject, Age, Sex, Valence,Identity, sdt) %>%
  dplyr::summarise(N = length(sdt)) %>%                                    # calculate the counts for each 
  dplyr::ungroup() %>%
  tidyr::spread(key = sdt, value = N,fill = 0) %>%                          # long-to-wide format
  dplyr::mutate(hitR = hit/(hit + miss),                                    # hit rate
                FAR  = FA/(FA+CR)) %>%                                      # fa rate
  dplyr::mutate(hitR = ifelse(hitR == 1, 1 - 1/(2*(hit + miss)), hitR),     # if hit rate is 1, standardize it
                FAR  = ifelse(FAR == 0, 1/(2*(hit + miss)), FAR)) %>%       # if FA rate is 0, standardize it
  dplyr::mutate(dprime = qnorm(hitR) - qnorm(FAR)) %>%
  dplyr::select(Site, Subject, Age, Sex, Valence, Identity, dprime) %>%     # select relevant columns
  dplyr::mutate(Valence = factor(Valence, levels = c("Good","Neutral","Bad")),
                Identity = factor(Identity, levels = c('Self', 'Other')))

# Day2: match trials
df6b_d2.v.rt_m1 <- df6b_d2.v %>%
  dplyr::filter(ACC == 1 & Matchness == "Match") %>%
  dplyr::group_by(Site, Subject, Matchness, Identity, Valence) %>%
  dplyr::summarise(RT_m = mean(RT),
                   Ntrial = length(RT)) %>%
  dplyr::ungroup() %>%
  dplyr::mutate(Valence = factor(Valence, levels = c("Good","Neutral","Bad")),
                Identity = factor(Identity, levels = c('Self', 'Other')))

# rtdata <- df6b_d2.v.rt_m1 %>% dplyr::filter(Matchness == "Match") %>% dplyr::rename(RT = RT_m)
# 
# Mplots(expName = 'exp6b_d2', df6b_d2.v.dprime_l,rtdata)

Val_id_plot_NHST(df.rt=df6b_d2.v.rt_m1, df.d=df6b_d2.v.dprime_l)
```

### Day two

Figure \@ref(fig:ex6b-d2-dprime-rt) shows *d* prime and reaction times from day 2 of the experiment 6b. 

# Self-reported personal distance

```{r personal distance, echo=FALSE, results='hide', warning=FALSE, message=FALSE}
# prepare questionnaire data
df.scales <- read.csv(here::here("scales", "FADGS_dataset4ID_clean.csv"), header = TRUE, sep = ",",
                 stringsAsFactors=FALSE,na.strings=c("","NA")) %>%
  dplyr::mutate(expID = dplyr::case_when(
                                    (expID == "exp1.0") ~ "Exp1a",
                                    (expID == "exp1.1") ~ "Exp1b",
                                    (expID == "exp3")   ~ "Exp3a",
                                    (expID == "exp3.1") ~ "Exp3b",
                                    (expID == "exp4.1") ~ "Exp4a",
                                    (expID == "exp4.2") ~ "Exp4b",
                                    (expID == "exp5.2") ~ "Exp5",
                                    (expID == "exp6.2") ~ "Exp6b",
                                    (expID == "exp7.1") ~ "Exp7a",
                                    (expID == "exp7r")  ~ "Exp7b",
                                    (expID == "exp6")   ~ "Exp_dpr"))

## get the questionnaire names
# Self-esteem
SlfEstNames <- c("SES1","SES2","SES3","SES4","SES5","SES6","SES7","SES8","SES9","SES10")
SlfEstNames_r <- c("SES1","SES2","SES3_r","SES4","SES5_r","SES6","SES7","SES8","SES9_r","SES10_r")

# moral identity
mrlIdNames <- c("morId_1","morId_2","morId_3","morId_4", "morId_5","morId_6",
                "morId_7","morId_8","morId_9","morId_10","morId_11","morId_12",
                "morId_13","morId_14","morId_15","morId_16")

mrlIdIntNames <- c("morId_1","morId_2","morId_5","morId_8", "morId_10","morId_11",
                   "morId_12","morId_13","morId_14")
mrlIdIntNames_r <- c("morId_1","morId_2","morId_5_r","morId_8", "morId_10","morId_11",
                   "morId_12","morId_13","morId_14")
mrlIdExtNames <- c("morId_3","morId_4", "morId_6", "morId_7", "morId_9",
                   "morId_15", "morId_16")

# moral self images
mrlslfImgNames <- c("morSlfImg_1","morSlfImg_2","morSlfImg_3","morSlfImg_4",
                    "morSlfImg_5","morSlfImg_6","morSlfImg_7","morSlfImg_8","morSlfImg_9")

# personal distance
perDistNames <- c("SelfSelf", 
                  "SelfGood_1", "SelfGood_2", "SelfGood_3", "SelfGood_4",
                  "SelfNeut_1", "SelfNeut_2", "SelfNeut_3", "SelfNeut_4",
                  "SelfBad_1",  "SelfBad_2",  "SelfBad_3",  "SelfBad_4",
                  "SelfStra_1", "SelfStra_2", "SelfStra_3", "SelfStra_4",
                  "GoodNeut_1", "GoodNeut_2", "GoodNeut_3", "GoodNeut_4", 
                  "GoodBad_1",  "GoodBad_2",  "GoodBad_3",  "GoodBad_4",
                  "NeutBad_1",  "NeutBad_2",  "NeutBad_3",  "NeutBad_4")

perDistNames2 <- c("SelfGood_1", "SelfGood_2", "SelfGood_3", "SelfGood_4",
                  "SelfNeut_1", "SelfNeut_2", "SelfNeut_3", "SelfNeut_4",
                  "SelfBad_1",  "SelfBad_2",  "SelfBad_3",  "SelfBad_4",
                  "GoodNeut_1", "GoodNeut_2", "GoodNeut_3", "GoodNeut_4", 
                  "GoodBad_1",  "GoodBad_2",  "GoodBad_3",  "GoodBad_4",
                  "NeutBad_1",  "NeutBad_2",  "NeutBad_3",  "NeutBad_4")

# Normalize the person distance by dividing the maximum value for each data point
df.perdist <- df.scales %>%
  dplyr::select(c(expID, subjID),perDistNames) %>%
  dplyr::mutate(sd_raw = matrixStats::rowSds(as.matrix(.[perDistNames]))) %>%
  dplyr::filter(sd_raw >=10) %>%                                # remove data with small variance
  dplyr::mutate(maxDist = pmax(!!!rlang::syms(perDistNames)))   # find the maximum value of the row

df.perdist[,3:31] <- df.perdist[,3:31]/df.perdist$maxDist       # dividing the maximum

# Get the mean value of each distance
df.perdist <- df.perdist %>%        
    dplyr::mutate(# sumRaw = rowMeans(.[3:31], na.rm = T),
                SelfGood = rowMeans(.[grep("SelfGood", names(.))], na.rm = T),
                SelfNeut = rowMeans(.[grep("SelfNeut", names(.))], na.rm = T),
                SelfBad  = rowMeans(.[grep("SelfBad", names(.))], na.rm = T),
                GoodNeut = rowMeans(.[grep("GoodNeut", names(.))], na.rm = T),
                GoodBad  = rowMeans(.[grep("GoodBad", names(.))], na.rm = T),
                NeutBad  = rowMeans(.[grep("NeutBad", names(.))], na.rm = T)) %>%
    dplyr::select(expID, subjID,
                SelfGood, SelfNeut, SelfBad, GoodNeut, GoodBad, NeutBad) %>%
  tidyr::drop_na()

# calculate the factor score for moral identity, moral self image, self-esteem, and personal distance.

df.scales <- df.scales %>%
  dplyr::mutate(morId_5_r = 0 - morId_5, # reverse the items that need to be reversed.
                SES3_r = 5 - SES3,
                SES5_r = 5 - SES5,
                SES9_r = 5 - SES9,
                SES10_r = 5 - SES10) %>%
  dplyr::mutate(SlfEst_sum = rowSums(.[SlfEstNames_r]),
                mrlIdInt_sum = rowSums(.[mrlIdIntNames_r]),
                mrlIdExt_sum = rowSums(.[mrlIdExtNames]),
                mrlSlfImg_sum = rowSums(.[mrlslfImgNames]))

df.scale.fs <- df.scales %>% dplyr::select(expID, subjID, SlfEst_sum, mrlIdInt_sum, mrlIdExt_sum, mrlSlfImg_sum)

df.scale.fs <- df.scale.fs %>%
  dplyr::left_join(., df.perdist)
```

```{r plot-person-dist, fig.cap="Self-rated personal distance", fig.width=8, warning=FALSE}
# Boxplot
p_dist_1 <- df.perdist %>% 
  tidyr::pivot_longer(., cols = SelfGood:NeutBad,
                      names_to = 'PerDist',
                      values_to = 'value') %>%
  dplyr::mutate(PerDist=factor(PerDist, levels = c('SelfNeut', 'SelfGood', 'GoodNeut', 'NeutBad', 'GoodBad', 'SelfBad'))) %>%
  ggplot2::ggplot(.,aes(x=PerDist, y=value)) +
  ggplot2::geom_boxplot() +
  ggplot2::geom_point(position = position_jitter(),size = 1, shape = 20, alpha = 0.15) + 
  scale_fill_brewer(palette = "Dark2") +
    theme_bw() +
    theme(panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(),
          panel.background = element_blank(),
          panel.border = element_blank(),
          text=element_text(family='Times'),
          legend.title=element_blank(),
          legend.text = element_text(size =12),
          plot.title = element_text(lineheight=.8, face="bold", size = 16, margin=margin(0,0,20,0)),
          axis.text = element_text (size = 12, color = 'black'),
          axis.title = element_text (size = 12),
          axis.title.x = element_blank(),
          axis.title.y = element_blank(),
          axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1),
          axis.line.x = element_line(color='black', size = 1),    # increase the size of font
          axis.line.y = element_line(color='black', size = 1),    # increase the size of font
          strip.text = element_text (size = 12, color = 'black'), # size of text in strips, face = "bold"
          panel.spacing = unit(3, "lines")) 

dist.cor <- df.perdist %>%
  dplyr::select(-c(subjID, expID)) %>%
  as.matrix() %>%
  Hmisc::rcorr(., type = 'spearman')

# dist.cor_par <- df.perdist %>%
#         dplyr::select(-c(subjID, expID)) %>%
#         qgraph::cor_auto(.)
# 
# dist.cor_par_net <- bootnet::estimateNetwork(dist.cor_par, default = "pcor", corMethod = 'spearman')
# plot(dist.cor_par_net)

p_dist_2 <- ggcorrplot::ggcorrplot(dist.cor$r, hc.order = TRUE, type = "lower",
     outline.col = "white", colors = c('red', 'white', 'blue'),
     lab = TRUE, p.mat = dist.cor$P) +
  #theme_bw() +
  scale_y_discrete(position='right') +
  theme(panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(),
          panel.background = element_blank(),
          panel.border = element_blank(),
          text=element_text(family='Times'),
          legend.title=element_blank(),
          legend.text = element_text(size =12),
          plot.title = element_text(lineheight=.8, face="bold", size = 16, margin=margin(0,0,20,0)),
          axis.text = element_text (size = 12, color = 'black'),
          axis.title = element_text (size = 12),
          axis.title.x = element_blank(),
          axis.title.y = element_blank(),
          axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1),
          #axis.line.x = element_line(color='black', size = 1),    # increase the size of font
          #axis.line.y = element_line(color='black', size = 1),    # increase the size of font
          strip.text = element_text (size = 12, color = 'black'), # size of text in strips, face = "bold"
          panel.spacing = unit(0, "lines")) 

# correlation bewteen self-reported measures
dist.cor2 <- df.scale.fs %>%
  dplyr::select(-1, -2) %>%
  as.matrix() %>%
  Hmisc::rcorr(., type = 'spearman')

p_dist_3 <- ggcorrplot::ggcorrplot(dist.cor2$r, hc.order = TRUE, type = "lower",
     outline.col = "white", colors = c('red', 'white', 'blue'),  insig = "blank",
     lab = TRUE, p.mat = dist.cor2$P) +
  #theme_bw() +
  scale_y_discrete(position='right') +
  theme(panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(),
          panel.background = element_blank(),
          panel.border = element_blank(),
          text=element_text(family='Times'),
          legend.title=element_blank(),
          legend.text = element_text(size =12),
          plot.title = element_text(lineheight=.8, face="bold", size = 16, margin=margin(0,0,20,0)),
          axis.text = element_text (size = 12, color = 'black'),
          axis.title = element_text (size = 12),
          axis.title.x = element_blank(),
          axis.title.y = element_blank(),
          axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1),
          #axis.line.x = element_line(color='black', size = 1),    # increase the size of font
          #axis.line.y = element_line(color='black', size = 1),    # increase the size of font
          strip.text = element_text (size = 12, color = 'black'), # size of text in strips, face = "bold"
          panel.spacing = unit(0, "lines")) 

library(patchwork)
p_dist_1 + p_dist_2 + plot_annotation(tag_levels = 'A')  + plot_layout(nrow = 1, byrow = FALSE)
```

```{r plot-person-dist-net, fig.cap="Self-rated personal distance (Network view)", fig.width=8, warning=FALSE}
df.perdist.sum_p <- df.perdist %>%
        dplyr::rename(Self_Good = SelfGood,
                      Self_Neut = SelfNeut,
                      Self_Bad = SelfBad,
                      Good_Neut = GoodNeut,
                      Good_Bad = GoodBad,
                      Neut_Bad = NeutBad) %>%
  tidyr::pivot_longer(cols = Self_Good:Neut_Bad, 
                      names_to = "condition",
                      values_to = "distance") %>%
  #dplyr::mutate(condition = factor(condition,
  #                                 levels = c("GoodNeut", "NeutBad", "GoodBad",
  #                                            "SelfNeut", "SelfGood", "SelfBad"))) %>%
  dplyr::filter(!is.na(distance)) %>%
  dplyr::group_by(condition) %>%
  dplyr::summarise_each(funs(mean, sd, se=sd(.)/sqrt(n())), distance) %>%
  dplyr::select(condition, mean) %>%
  dplyr::add_row(condition = c("Self_Self", "Good_Good",
                                "Neut_Neut","Bad_Bad")) %>%
  tidyr::separate(condition, c('var1','var2'), sep = '_')

# create a distance matrix
df.dist.mat <- data.frame(matrix(ncol = 4, nrow = 4))
colnames(df.dist.mat) <- unique(df.perdist.sum_p$var1)
rownames(df.dist.mat) <- unique(df.perdist.sum_p$var1)

for (i in 1:6){
  rname = df.perdist.sum_p$var1[i]
  cname = df.perdist.sum_p$var2[i]
  value = df.perdist.sum_p$mean[i]
  df.dist.mat[rname, cname] = value
  df.dist.mat[cname, rname] = value
}
df.dist.mat[is.na(df.dist.mat)] <- 0

df.dist.mat_t <- 1 - df.dist.mat

library(qgraph)
p_dist_4 <- qgraph(df.dist.mat_t, layout='spring', vsize=9, labels = colnames(df.dist.mat_t))

# p_dist_5 <- qgraph(dist.cor$r, layout='spring', vsize=9, labels = colnames(dist.cor$r))

# 
# corrplot(dist.cor$r, type = "upper", order = "hclust", 
#          tl.col = "black", tl.srt = 45,
#          p.mat = dist.cor$P, sig.level = 0.01, insig = "blank")

# col <- colorRampPalette(c( "red", "white", "blue"))(20)
# p_dist_2 <- heatmap(x = dist.cor$r, col = col, symm = TRUE)
# 
# corrplot(dist.cor$r, type="upper", order="hclust", col=col)
# legend(x="bottomright", legend=c("min", "ave", "max"), 
#      fill=colorRampPalette(c( "red", "white", "blue"))(20))

```

We explored the self-reported psychological distance between different person. Participants were presented a pair of two-person each time, and moved a slide to represent the distance between the pair of two persons. We found that, on average, participants rated self is closest to a neutral person, and then a good person. These two are not different from each other. However, both are closer than the distance between good person and neutral person. On average, participants rated themselves has furthest distance to bad person.

Correlation analysis showed that most psychological distance ratings were positively correlated to each other, but the self-bad and self-good are negatively correlated. 

[use the network view to visualize the distance]

See Figure \@ref(fig:plot-person-dist) and Figure \@ref(fig:plot-person-dist-net).

\newpage

# References
```{r create_r-references}
papaja::r_refs(file = "r-references.bib")
```

\begingroup
\setlength{\parindent}{-0.5in}
\setlength{\leftskip}{0.5in}

<div id = "refs"></div>
\endgroup
